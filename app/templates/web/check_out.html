{% csrf_token %}
<!DOCTYPE html>
<html>

<head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Site Metas -->
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <link rel="shortcut icon" href="/static/web/img/favicon.png" type="">

    <title> Jewellery Shop Management </title>

    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="/static/web/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/static/web/css/style1.css">
    <link rel="stylesheet" type="text/css"
        href="/static/web/bootstrap-icons-1.8.1/bootstrap-icons-1.8.1/bootstrap-icons.css">

    <!--owl slider stylesheet -->
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
    <!-- nice select  -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css"
        integrity="sha512-CruCP+TD3yXzlvvijET8wV5WxxEh5H8P4cmz0RFbKK6FlZ2sYl3AEsKlLPHbniXKSrDdFewhbmBK5skbdsASbQ=="
        crossorigin="anonymous" />
    <!-- font awesome style -->
    <link href="/static/web/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="/static/web/css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="/static/web/css/responsive.css" rel="stylesheet" />

</head>

<body style="background-color: rgb(239, 233, 151);">

    <section>
        <nav class="navbar navbar-expand-lg navbar-light bg-warning fixed-top">
            <div class="container-fluid">
                <div class="navbar-brand text-outline-danger  fs-2 fw-bold  fst-italic" id="nav1" href="#">Jewellery
                    <sub>Shop Management</sub>
                </div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <!-- e-left s-right x-center -->
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active fs-5 " aria-current="page" href="/index/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link  active fs-5" href="/Aboutus/">About Us</a>

                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle active fs-5" href="#" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Services
                            </a>
                            <ul class="dropdown-menu bg-warning" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="/purity/">Purity</a></li>
                                <li><a class="dropdown-item" href="/purity/">Quality</a></li>
                                <li><a class="dropdown-item" href="/purity/">Stylish</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link  active fs-5" href="/Gold/">Shop</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active fs-5" href="/welcome/">Logout</a>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>
    </section>
    <input type="hidden" id="txtID" value="{{request.GET.id}}">
    <!-- check out -->
    <div class="container my-5 py-3">

        <div class="mt-5">
            <table class="table">
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>QTY</th>
                </tr>
                <tbody id="cartTable">

                </tbody>
            </table>
        </div>
        <div class="row g-5 my-5 py-3">
            <div class="col-md-5 col-lg-4 order-md-last">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-primary">Your cart</span>
                    <span class="badge bg-primary rounded-pill"></span>
                </h4>
                <ul class="list-group mb-3">

                    <li class="list-group-item d-flex justify-content-between">
                        <span>Total (Rupees)</span>
                        <strong id="txtTotalAmt">Rs 0.00</strong>
                    </li>
                </ul>
            </div>
            <div class="col-md-7 col-lg-8">
                <h4 class="mb-3">Billing address</h4>
                <form class="needs-validation" novalidate="" action="/payment/">
                    <div class="row g-3">
                        <div class="col-sm-6">
                            <label htmlFor="firstName" class="form-label">Full name</label>
                            <input type="text" class="form-control" id="txtName" placeholder="Full Name" value=""
                                required="" />
                            <div class="invalid-feedback">
                                Valid first name is required.
                            </div>
                        </div>



                        <div class="col-6">
                            <label htmlFor="email" class="form-label">Email </label>
                            <input type="email" class="form-control" id="txtEmail" placeholder="you@example.com" />
                            <div class="invalid-feedback">
                                Please enter a valid email address for shipping updates.
                            </div>
                        </div>

                        <div class="col-6">
                            <label htmlFor="email" class="form-label">Mobile </label>
                            <input type="email" class="form-control" id="txtMobileNo" placeholder="Mobile Number" />
                            <div class="invalid-feedback">
                                Please enter a valid email address for shipping updates.
                            </div>
                        </div>

                        <div class="col-6">
                            <label htmlFor="address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="txtAddress" placeholder="Address" required="" />
                            <div class="invalid-feedback">
                                Please enter your shipping address.
                            </div>
                        </div>

                        <div class="col-md-5">
                            <label htmlFor="country" class="form-label">Country</label>
                            <select class="form-select" id="country" required="">
                                <option value="">Choose</option>
                                <option>India</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select a valid country.
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label htmlFor="state" class="form-label">State</label>
                            <select class="form-select" id="state" required="">
                                <option value="">Choose</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chandigarh">Chandigarh</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
                                <option value="Daman and Diu">Daman and Diu</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Lakshadweep">Lakshadweep</option>
                                <option value="Puducherry">Puducherry</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                            </select>
                            <div class="invalid-feedback">
                                Please provide a valid state.
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label htmlFor="zip" class="form-label">Pin Code</label>
                            <input type="text" class="form-control" id="pin" placeholder="" required="" />
                            <div class="invalid-feedback">
                                Zip code required.
                            </div>
                        </div>
                    </div>

                    <hr class="my-4" />



                    <button class="w-100 btn btn btn-danger btn-lg" type="button" id="btn_submit">Continue to
                        checkout</button>
                </form>
            </div>
        </div>
    </div>
    <!-- check out end  -->


    <!-- footer section -->
    <footer id="footer">

        <div class="footer-top">
            <div class="container align-items-center">
                <div class="row">

                    <div class="col-4" style="padding-left: 10%;">
                        <h3>Company</h3>
                        <p>
                            Info <br>
                            Belagavi <br><br>
                            <strong>Phone:</strong> +91 123456789<br>
                            <strong>Email:</strong> info.com<br>
                        </p>
                    </div>

                    <div class="col-lg-4  footer-links mb-2 pb-5" style="padding-left: 10%;">
                        <h3>Useful Links</h3>
                        <ul class="pt-4">
                            <li><i class="bx bx-chevron-right"></i> <a href="/index/">Home</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="/Aboutus/">About us</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="/purity/">Services</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="/Aboutus/">Terms of service</a></li>
                        </ul>
                    </div>

                    <!-- <div class="col-lg-3 col-md-6 footer-links">
                        <h3>Our Services</h3>
                        <ul>
                            <li><i class="bx bx-chevron-right"></i> <a href="#">Web Design</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="#">Web Development</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="#">Product Shop Management</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="#">Marketing</a></li>
                            <li><i class="bx bx-chevron-right"></i> <a href="#">Graphic Design</a></li>
                        </ul>
                    </div> -->

                    <div class="col-4" style="padding-left: 10%;">
                        <h3>Media Services</h3><br>
                        <div class="header-social-links d-flex fs-5 text-light">
                            <ul>
                                <i class="text-light bu bi-twitter"></i> <a href="#" class="text-light">Twitter</a><br>
                                <i class="text-light bu bi-facebook"></i> <a href="#"
                                    class="text-light">Facebook</a><br>
                                <i class="text-light bu bi-instagram"></i> <a href="#" class="text-light">Instagram</a>


                            </ul>





                        </div>
                    </div>



                </div>
            </div>
        </div>

        <div class="container-fluid p-4 fs-5">

            <div class="me-md-auto text-center text-md-start">
                <div class="copyright text-center">
                    &copy; Copyright <strong><span> Jewellery Shop Management</span></strong>. All Rights Reserved
                </div>


            </div>


        </div>


    </footer>
    <!-- footer section -->
    <input type="hidden" id="productImage">
    <input type="hidden" id="productQTY">
    <input type="hidden" id="productName">
    <input type="hidden" id="productPrice">
    <input type="hidden" id="productTotal">
    <input type="hidden" id="productVendor">

</body>
<!-- jQery -->
<!-- <script src="/static/web/js/jquery-3.4.1.min.js"></script> -->
<!-- popper js -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
<!-- bootstrap js -->
<!-- <script src="/static/web/js/bootstrap.js"></script> -->
<!-- owl slider -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js">
</script>
<!-- isotope js -->
<script src="https://unpkg.com/isotope-layout@3.0.4/dist/isotope.pkgd.min.js"></script>
</script>
<!-- End Google Map -->
<script src="/static/web/bootCJ/js/bootstrap.min.js"></script>
<script src="/static/vendor/js/datatables-simple-demo.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script type="text/javascript">

    var lclTotalAmt = 0;
    var j = 0;


    function getCart() {

        var formData = new FormData();
        formData.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val());

        $.ajax({

            url: "/get_cart/",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {

                for (var i = 0; i < response.length; i++) {
                    $("#txtProductName").val(response[i].ct_name);

                    j = i + 1;
                    var imgSub = response[i].ct_image.substring(8);
                    // $("#cartTable").append('<li> '+response[i].ct_name+' <span>₹ '+response[i].ct_total_amount+'</span></li>');

                    $("#cartTable").append('<tr><td>' + response[i].ct_name + '</td><td>' + response[i].ct_total_amount + '</td><td>' + response[i].ct_weight + '</td></tr>');

                    lclTotalAmt = lclTotalAmt + response[i].ct_total_amount;

                    if ($("#productImage").val() == "") {
                        $("#productImage").val(imgSub)
                    } else {
                        $("#productImage").val($("#productImage").val() + "<>" + imgSub);
                    }

                    if ($("#productQTY").val() == "") {
                        $("#productQTY").val(response[i].ct_weight)
                    } else {
                        $("#productQTY").val($("#productQTY").val() + "<>" + response[i].ct_weight);
                    }

                    if ($("#productName").val() == "") {
                        $("#productName").val(response[i].ct_name)
                    } else {
                        $("#productName").val($("#productName").val() + "<>" + response[i].ct_name);
                    }

                    if ($("#productPrice").val() == "") {
                        $("#productPrice").val(response[i].ct_price)
                    } else {
                        $("#productPrice").val($("#productPrice").val() + "<>" + response[i].ct_price);
                    }

                    if ($("#productTotal").val() == "") {
                        $("#productTotal").val(response[i].ct_total_amount)
                    } else {
                        $("#productTotal").val($("#productTotal").val() + "<>" + response[i].ct_total_amount);
                    }

                    if ($("#productVendor").val() == "") {
                        $("#productVendor").val(response[i].ct_created_by)
                    } else {
                        $("#productVendor").val($("#productVendor").val() + "<>" + response[i].ct_created_by);
                    }

                }

                // alert(lclTotalAmt);
                $("#txtTotalAmt").text("₹" + lclTotalAmt);
            }

        });

    }

    function getBuyNowURLProduct() {

        let formData = new FormData();
        formData.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val());
        formData.append("txtID", $("#txtID").val());

        let url = window.location.href;
        let count = window.location.href.length;
        // alert(count);
        let mainValue = 0;
        if (count == 43) {
            mainValue = url.substring(count, count - 1);
        } else {
            mainValue = url.substring(count, count - 2);
        }

        // alert(mainValue);

        $.ajax({

            url: "/get_buy_now_url/",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                // var lclTotalAmt = 0;
                for (var i = 0; i < response.length; i++) {
                    j = j + 1;
                    var imgSub = response[i].ap_image.substring(8);

                    $("#cartTable").append('<tr><td>' + response[i].ap_name + '</td><td>' + response[i].ap_rate + '</td><td>' + response[i].ap_weight + '</td></tr>');

                    lclTotalAmt = lclTotalAmt + parseFloat(response[i].ap_rate * mainValue);


                    if ($("#productImage").val() == "") {
                        $("#productImage").val(imgSub)
                    } else {
                        $("#productImage").val($("#productImage").val() + "<>" + imgSub);
                    }

                    if ($("#productQTY").val() == "") {
                        $("#productQTY").val(mainValue)
                    } else {
                        $("#productQTY").val($("#productQTY").val() + "<>" + mainValue);
                    }

                    if ($("#productName").val() == "") {
                        $("#productName").val(response[i].ap_name)
                    } else {
                        $("#productName").val($("#productName").val() + "<>" + response[i].ap_name);
                    }

                    if ($("#productPrice").val() == "") {
                        $("#productPrice").val(response[i].ap_rate)
                    } else {
                        $("#productPrice").val($("#productPrice").val() + "<>" + response[i].ap_rate);
                    }

                    if ($("#productTotal").val() == "") {
                        $("#productTotal").val(parseFloat(response[i].ap_rate * mainValue))
                    } else {
                        $("#productTotal").val($("#productTotal").val() + "<>" + parseFloat(response[i].ap_rate * mainValue));
                    }

                    if ($("#productVendor").val() == "") {
                        $("#productVendor").val(response[i].ap_created_by)
                    } else {
                        $("#productVendor").val($("#productVendor").val() + "<>" + response[i].ap_created_by);
                    }

                }

                // alert(response.length);
                if (response.length) {
                    $("#txtTotalAmt").text("₹" + lclTotalAmt);
                }

            }

        });

    }

    getCart();

    if ($("#txtID").val() != "") {
        getBuyNowURLProduct();
    }


    $(document).ready(function () {


        $("#btn_submit").click(function (e) {
            //verification
            if ($("#txtName").val().trim().length < 1) {
                alert("Please Enter Full Name");
                $("#txtName").focus();
                return false;
            }

            if ($("#txtMobileNo").val().trim().length < 10) {
                alert("Please Enter Mobile number");
                $("#txtMobileNo").focus();
                return false;
            }

            if ($("#txtEmail").val().trim().length < 1) {
                alert("Please Enter Email");
                $("#txtEmail").focus();
                return false;
            }

            if ($("#txtAddress").val().trim().length < 1) {
                alert("Please Enter Address");
                $("#txtAddress").focus();
                return false;
            }

            var d = new Date();
            var date = d.getDate();

            var d = new Date();
            var month = d.getMonth() + 1;

            var d = new Date();
            var year = d.getFullYear();

            var lclDate = date + "-" + month + "-" + year;

            var formData = new FormData();

            formData.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val());
            formData.append("txtName", $("#txtName").val());
            formData.append("txtMobileNo", $("#txtMobileNo").val());
            formData.append("txtEmail", $("#txtEmail").val());
            formData.append("txtAddress", $("#txtAddress").val());
            formData.append("txtDate", lclDate);
            formData.append("txtProductName", $("#txtProductName").val());
            var lclTotalAmt = ($("#txtTotalAmt").text().trim()).substring(1);
            formData.append("totalAmt", lclTotalAmt);

            formData.append("productImage", $("#productImage").val());
            formData.append("productQTY", $("#productQTY").val());
            formData.append("productName", $("#productName").val());
            formData.append("productPrice", $("#productPrice").val());
            formData.append("productTotal", $("#productTotal").val());
            formData.append("productVendor", $("#productVendor").val());

            formData.append("action", "order");

            $.ajax({
                beforeSend: function () {
                    // $(".btn .spinner-border").show();
                    $("#continue_button").attr("disabled", true);
                },
                url: "/checkout/payment/",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                    payment(lclTotalAmt);
                },
                error: function (request, error) {
                    console.error(error);
                },
                complete: function () {
                    // $(".btn .spinner-border").hide();
                    $("#continue_button").attr("disabled", false);
                },
            });
        });

    });

    function payment(amount) {

        var totalAmount = amount;
        var options = {
            "key": "rzp_test_aKbqVbQ3Ciq9KZ",
            // rzp_live_fAt71isKlJSzhX
            "amount": (totalAmount * 100), // 2000 paise = INR 20
            "name": "Jewelary",
            "description": "Payment",
            "handler": function (response) {
                // alert(response.razorpay_payment_id);
                // submitRegDetails(response.razorpay_payment_id);
                window.location.href = '/pay_success?name=' + $("#txtName").val() + '&email=' + $("#txtEmail").val() + '&mobile=' + $("#txtMobileNo").val() + '&amount=' + amount + '&transaction_id=' + response.razorpay_payment_id;
                // alert("Payment is successfull, Thank you for Purchasing with us");
                // window.location.href = "";

            },
            "prefill": {
                "contact": $("#txtMobileNo").val(),
                "email": $("#txtEmail").val(),
            },

            "theme": {
                "color": "#4caf50"
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.open();
        // preventDefault();
        // });

    }
    

</script>

</html>